{% extends "app/base.html" %}
{% block title %}RC Stores - Checkout{% endblock %}

{% block content %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>

<style>
  body {
    background-color: #1b1b1b;
    color: #f0f0f0;
  }

  .checkout-container {
    background-color: #252525;
    border: 1px solid #00ffc8;
    border-radius: 10px;
    padding: 2rem;
    margin: 2rem auto;
    box-shadow: 0 0 15px rgba(0, 255, 200, 0.1);
  }

  .checkout-header {
    color: #00ffc8;
    border-bottom: 2px solid #00ffc8;
    padding-bottom: 1rem;
    margin-bottom: 2rem;
    text-align: center;
  }

  .form-control,
  .form-select,
  textarea {
    background-color: #1c1c1c !important;
    color: #fff !important;
    border: 1px solid #444;
  }

  .form-control:focus,
  .form-select:focus,
  textarea:focus {
    border-color: #00ffc8;
    box-shadow: 0 0 0 0.2rem rgba(0, 255, 200, 0.25);
  }

  .payment-option {
    border: 1px solid #444;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    transition: 0.3s;
  }

  .payment-option:hover,
  .payment-option.selected {
    border-color: #00ffc8;
    background-color: rgba(0, 255, 200, 0.1);
  }

  .btn-submit {
    background-color: #00ffc8;
    border: none;
    color: #111;
    font-weight: bold;
    transition: 0.3s;
  }

  .btn-submit:hover {
    background-color: #00e6b8;
    transform: translateY(-2px);
  }

  .order-summary {
    background-color: #1c1c1c;
    border: 1px solid #333;
    border-radius: 10px;
    padding: 1.5rem;
  }
</style>

<div class="container checkout-container">
  <h2 class="checkout-header">
    <i class="bi bi-cart-check"></i> Checkout
  </h2>

  <div class="row g-4">
    <!-- Left: Order Summary -->
    <div class="col-lg-5">
      <div class="order-summary">
        <h4 class="text-success mb-4">
          <i class="bi bi-box-seam"></i> Order Summary
        </h4>

        <div>
          <h5>{{ product_name }}</h5>
          <p class="text-muted mb-2">
            Quantity: {{ quantity }} × ₹{{ unit_price|default:total_price }}
            {% if selected_size %}<br />Size: {{ selected_size }}{% endif %}
          </p>
        </div>

        <hr />

        <div class="d-flex justify-content-between">
          <span>Subtotal:</span><span>₹{{ total_price }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span>Shipping:</span><span id="shipping-display">₹50</span>
        </div>
        <hr />
        <div class="d-flex justify-content-between fw-bold text-success">
          <span>Total:</span>
          <span id="total-display">₹{{ total_price|add:50 }}</span>
        </div>
      </div>
    </div>

    <!-- Right: Checkout Form -->
    <div class="col-lg-7">
      <form method="POST" id="checkoutForm" class="needs-validation" novalidate>
        {% csrf_token %}
        <input type="hidden" name="product_name" value="{{ product_name }}" />
        <input type="hidden" name="quantity" value="{{ quantity }}" />
        <input type="hidden" name="total_price" value="{{ total_price }}" />

        <h4 class="text-success mb-3">
          <i class="bi bi-person-circle"></i> Contact Information
        </h4>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Full Name</label>
            <input
              type="text"
              name="customer_name"
              id="customer_name"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-6">
            <label class="form-label">Mobile Number</label>
            <input
              type="tel"
              name="mobile"
              id="mobile"
              class="form-control"
              required
            />
          </div>
        </div>

        <h4 class="text-success mt-4 mb-3">
          <i class="bi bi-geo-alt"></i> Shipping Address
        </h4>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Country</label>
            <select
              name="country"
              id="country"
              class="form-select"
              required
            >
              <option value="">Select Country</option>
              <option value="India" selected>India</option>
              <option value="USA">United States</option>
              <option value="UK">United Kingdom</option>
              <option value="Canada">Canada</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Pincode</label>
            <input
              type="text"
              name="pincode"
              id="pincode"
              class="form-control"
              required
            />
          </div>
          <div class="col-12">
            <label class="form-label">Full Address</label>
            <textarea
              name="address"
              id="address"
              rows="3"
              class="form-control"
              required
            ></textarea>
          </div>
        </div>

        <h4 class="text-success mt-4 mb-3">
          <i class="bi bi-credit-card"></i> Payment Method
        </h4>

        <div class="row g-3">
          <div class="col-md-4">
            <div class="payment-option" onclick="selectPayment('cod', event)">
              Cash on Delivery
            </div>
          </div>
          <div class="col-md-4">
            <div class="payment-option" onclick="selectPayment('card', event)">
              Credit / Debit Card
            </div>
          </div>
          <div class="col-md-4">
            <div
              class="payment-option"
              onclick="selectPayment('paypal', event)"
            >
              PayPal
            </div>
          </div>
        </div>

        <input type="hidden" name="payment_method" id="payment_method" value="cod" />
        <input type="hidden" name="shipping_cost" id="shipping_cost" value="50" />

        <div class="mt-4">
          <button type="submit" class="btn btn-submit w-100 py-2">
            <i class="bi bi-bag-check-fill"></i> Place Order
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Default selection
  document.querySelector(".payment-option").classList.add("selected");
  let selectedPayment = "cod";

  function selectPayment(method, event) {
    selectedPayment = method;
    document.getElementById("payment_method").value = method;

    document.querySelectorAll(".payment-option").forEach((opt) =>
      opt.classList.remove("selected")
    );
    event.currentTarget.classList.add("selected");

    let shippingCost = 50;
    if (method === "card") shippingCost = 45;
    if (method === "paypal") shippingCost = 40;

    document.getElementById("shipping_cost").value = shippingCost;
    document.getElementById("shipping-display").textContent = `₹${shippingCost}`;
    const total = parseFloat("{{ total_price }}") + shippingCost;
    document.getElementById("total-display").textContent = `₹${total.toFixed(2)}`;
  }

  // Save user data
  document.getElementById("checkoutForm").addEventListener("submit", function () {
    const userData = {
      customer_name: document.getElementById("customer_name").value,
      mobile: document.getElementById("mobile").value,
      address: document.getElementById("address").value,
      pincode: document.getElementById("pincode").value,
      country: document.getElementById("country").value,
    };
    localStorage.setItem("user_data", JSON.stringify(userData));
    localStorage.setItem("payment_method", selectedPayment);
  });
</script>

<script
  src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.js"
></script>
{% endblock %}
